<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Screen & Video Sharing Streamer</title>
</head>
<body>
  <h1>Screen & Video Sharing Streamer</h1>
  <p>Status: <span id="status">Connecting...</span></p>
  <button id="startSharing">Start Screen & Video Sharing</button>

  <script>
    const status = document.getElementById('status');
    const startSharingBtn = document.getElementById('startSharing');

    // Use the WebSocket URL of your Render service
    const socket = new WebSocket('wss://your-service-name.onrender.com');

    socket.onopen = () => {
      status.textContent = 'Connected to server as streamer';
      socket.send(JSON.stringify({ type: 'streamer' }));
    };

    socket.onclose = () => {
      status.textContent = 'Disconnected from server';
    };

    startSharingBtn.onclick = async () => {
      try {
        // Capture screen
        const screenStream = await navigator.mediaDevices.getDisplayMedia({
          video: true,
          audio: false // Set to true if screen audio is needed
        });

        // Capture webcam
        const webcamStream = await navigator.mediaDevices.getUserMedia({
          video: true,
          audio: true // Set to true if microphone audio is needed
        });

        // Combine both screen and webcam tracks into one stream
        const combinedStream = new MediaStream([
          ...screenStream.getVideoTracks(),
          ...webcamStream.getVideoTracks()
        ]);

        status.textContent = 'Screen and video sharing started...';

        // Set up MediaRecorder for sending video data chunks
        const mediaRecorder = new MediaRecorder(combinedStream, {
          mimeType: 'video/webm; codecs=vp8'
        });

        // Send data chunks as they become available
        mediaRecorder.ondataavailable = (event) => {
          if (event.data.size > 0) {
            socket.send(event.data); // Send screen and video data chunks
          }
        };

        // Start recording and sending data every 100ms
        mediaRecorder.start(100);

        // Stop sharing when either screen or webcam track ends
        combinedStream.getTracks().forEach(track => {
          track.onended = () => {
            mediaRecorder.stop();
            socket.close();
            status.textContent = 'Screen and video sharing ended';
          };
        });

      } catch (err) {
        console.error('Error starting screen and video sharing:', err);
        status.textContent = 'Failed to start screen and video sharing';
      }
    };
  </script>
</body>
</html>
